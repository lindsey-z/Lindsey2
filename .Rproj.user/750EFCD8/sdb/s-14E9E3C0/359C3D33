{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Yelp Business Hours Final\"\nauthor: \"Lindsey Zhang\"\ndate: \"4/30/2017\"\noutput: word_document\n---\n\n```{r}\nsuppressWarnings(library(readr))\n\nyelp_business <- suppressWarnings(read_csv(\"~/Desktop/yelp_academic_dataset_business_train.csv\"))\n```\n\n```{r}\nlibrary(stringr)\n\nhours <- yelp_business$hours\nday_count <- str_count(hours, \"day\")\n\ncombined <- cbind(yelp_business$business_id, hours, day_count)\n```\n\n```{r}\nhours2 <- gsub(\"\\\\[|\\\\]\", \"\", hours)\n\nsplit <- strsplit(hours2, \"[,]\")\n\nget_time <- function(t){\n  split_1 <- gsub(\".*day\\\\s(.*?)*\", \"\", x = split[[t]] )\n\n  split_2 <- strsplit(split_1, \"'\")\n}\n\nsplit_3 <- sapply(1:length(split), get_time)\n\nget_business <- function(i){\n  matrix(unlist(split_3[[i]]), nrow = length(split_3[[i]]))\n}\n\n\nsplit_4 <- sapply(1:length(split_3), get_business)\nnames(split_4) <- yelp_business$business_id\n\nwow <- lapply(split_4, function(x) x[!is.na(x)])\nwow2 <- wow[lapply(wow,length)>0]\n\n#split_5 <- matrix(wow2, ncol = length(wow2))\nsplit_5 <- wow[lapply(wow,length)>0]\n###\nget_days <- function(i){\n  length(split_5[[i]])\n}\nnum_days <- sapply(1:length(split_5), get_days)\n\n###\nget_hours_one_business <- function(i){\n  clean <- strsplit(as.character(split_5[[i]]), \"-\")\n  \n  getpls <- function(k){\n    strsplit(as.character(clean[[k]]), \":\")\n  }\n  \n  cleaned <- sapply(1:num_days[i], getpls)\n\n  mat <- matrix(as.numeric(unlist(cleaned)), ncol = 4, byrow = TRUE)\n  \n  mat2 <- cbind(abs(mat[,3] - mat[,1]), abs(mat[,4] - mat[,2])/60)\n  \n  mat3 <- mat2[,1] + mat2[,2]\n  mat4 <- sum(mat3)\n}\n\nfinally <- as.data.frame(sapply(seq_along(split_5), get_hours_one_business))\n\nfinally2 <- cbind(names(split_5), finally)\n#names(finally) <- names(split_5)\n\ncolnames(finally2) <- c(\"business_id\", \"hours\")\nwrite.csv(finally2, file = \"business_hours\")\n\n\n```\n\n```{r}\nhead(finally)\n```\n\n\n```{r}\ncomplete <- yelp_business[complete.cases(yelp_business[,4]),]\n\nsuper <- as.data.frame(cbind(unlist(finally), complete$stars))\nplot(super[,1], super[,2])\n\nfit <- lm(super[,2]~super[,1], data = super)\nsummary(fit)\nplot(fit)\n```\n\n```{r}\ntest_business <- read_csv(\"~/Desktop/yelp_academic_dataset_business_test.csv\", col_names = TRUE)\n```\n\n```{r}\nlibrary(stringr)\n\nhours <- test_business$hours\nday_count <- str_count(hours, \"day\")\n\ncombined <- cbind(test_business$business_id, hours, day_count)\n```\n\n```{r}\nhours2 <- gsub(\"\\\\[|\\\\]\", \"\", hours)\n\nsplit <- strsplit(hours2, \"[,]\")\n\nget_time <- function(t){\n  split_1 <- gsub(\".*day\\\\s(.*?)*\", \"\", x = split[[t]] )\n\n  split_2 <- strsplit(split_1, \"'\")\n}\n\nsplit_3 <- sapply(1:length(split), get_time)\n\nget_business <- function(i){\n  matrix(unlist(split_3[[i]]), nrow = length(split_3[[i]]))\n}\n\n\nsplit_4 <- sapply(1:length(split_3), get_business)\nnames(split_4) <- test_business$business_id\n\nwow <- lapply(split_4, function(x) x[!is.na(x)])\nwow2 <- wow[lapply(wow,length)>0]\n\n#split_5 <- matrix(wow2, ncol = length(wow2))\nsplit_5 <- wow[lapply(wow,length)>0]\n###\nget_days <- function(i){\n  length(split_5[[i]])\n}\nnum_days <- sapply(1:length(split_5), get_days)\n\n###\nget_hours_one_business <- function(i){\n  clean <- strsplit(as.character(split_5[[i]]), \"-\")\n  \n  getpls <- function(k){\n    strsplit(as.character(clean[[k]]), \":\")\n  }\n  \n  cleaned <- sapply(1:num_days[i], getpls)\n\n  mat <- matrix(as.numeric(unlist(cleaned)), ncol = 4, byrow = TRUE)\n  \n  mat2 <- cbind(abs(mat[,3] - mat[,1]), abs(mat[,4] - mat[,2])/60)\n  \n  mat3 <- mat2[,1] + mat2[,2]\n  mat4 <- sum(mat3)\n}\n\nfinally <- as.data.frame(sapply(seq_along(split_5), get_hours_one_business))\n\nfinally2 <- cbind(names(split_5), finally)\n#names(finally) <- names(split_5)\n\ncolnames(finally2) <- c(\"business_id\", \"hours\")\nwrite.csv(finally2, file = \"test_business_hours.csv\")\n\n\n```\n\n\n\n\n\n",
    "created" : 1493845713869.000,
    "dirty" : true,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "927119589",
    "id" : "359C3D33",
    "lastKnownWriteTime" : 1493763712,
    "last_content_update" : 1493845934780,
    "path" : "~/Desktop/154/Yelp Business Hours Final.Rmd",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 6,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}
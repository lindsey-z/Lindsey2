split_2 <- strsplit(split_1, "'")
}
split_3 <- sapply(1:length(split), get_time)
get_business <- function(i){
matrix(unlist(split_3[[i]]), nrow = length(split_3[[i]]))
}
split_4 <- sapply(1:length(split_3), get_business)
names(split_4) <- yelp_business$business_id
wow <- lapply(split_4, function(x) x[!is.na(x)])
wow2 <- wow[lapply(wow,length)>0]
#split_5 <- matrix(wow2, ncol = length(wow2))
split_5 <- wow[lapply(wow,length)>0]
###
get_days <- function(i){
length(split_5[[i]])
}
num_days <- sapply(1:length(split_5), get_days)
###
get_hours_one_business <- function(i){
clean <- strsplit(as.character(split_5[[i]]), "-")
getpls <- function(k){
strsplit(as.character(clean[[k]]), ":")
}
cleaned <- sapply(1:num_days[i], getpls)
mat <- matrix(as.numeric(unlist(cleaned)), ncol = 4, byrow = TRUE)
mat2 <- cbind(abs(mat[,3] - mat[,1]), abs(mat[,4] - mat[,2])/60)
mat3 <- mat2[,1] + mat2[,2]
mat4 <- sum(mat3)
}
finally <- as.data.frame(sapply(seq_along(split_5), get_hours_one_business))
finally2 <- cbind(names(split_5), finally)
names(finally) <- names(split_5)
hours2 <- gsub("\\[|\\]", "", hours)
split <- strsplit(hours2, "[,]")
get_time <- function(t){
split_1 <- gsub(".*day\\s(.*?)*", "", x = split[[t]] )
split_2 <- strsplit(split_1, "'")
}
split_3 <- sapply(1:length(split), get_time)
get_business <- function(i){
matrix(unlist(split_3[[i]]), nrow = length(split_3[[i]]))
}
split_4 <- sapply(1:length(split_3), get_business)
names(split_4) <- yelp_business$business_id
wow <- lapply(split_4, function(x) x[!is.na(x)])
wow2 <- wow[lapply(wow,length)>0]
#split_5 <- matrix(wow2, ncol = length(wow2))
split_5 <- wow[lapply(wow,length)>0]
###
get_days <- function(i){
length(split_5[[i]])
}
num_days <- sapply(1:length(split_5), get_days)
###
get_hours_one_business <- function(i){
clean <- strsplit(as.character(split_5[[i]]), "-")
getpls <- function(k){
strsplit(as.character(clean[[k]]), ":")
}
cleaned <- sapply(1:num_days[i], getpls)
mat <- matrix(as.numeric(unlist(cleaned)), ncol = 4, byrow = TRUE)
mat2 <- cbind(abs(mat[,3] - mat[,1]), abs(mat[,4] - mat[,2])/60)
mat3 <- mat2[,1] + mat2[,2]
mat4 <- sum(mat3)
}
finally <- as.data.frame(sapply(seq_along(split_5), get_hours_one_business))
finally2 <- cbind(names(split_5), finally)
#names(finally) <- names(split_5)
final_bus_hour <- setDT(finally2, keep.rownames = TRUE)[]
colnames(final_bus_hour) <- c("business_id", "hours")
hours2 <- gsub("\\[|\\]", "", hours)
split <- strsplit(hours2, "[,]")
get_time <- function(t){
split_1 <- gsub(".*day\\s(.*?)*", "", x = split[[t]] )
split_2 <- strsplit(split_1, "'")
}
split_3 <- sapply(1:length(split), get_time)
get_business <- function(i){
matrix(unlist(split_3[[i]]), nrow = length(split_3[[i]]))
}
split_4 <- sapply(1:length(split_3), get_business)
names(split_4) <- yelp_business$business_id
wow <- lapply(split_4, function(x) x[!is.na(x)])
wow2 <- wow[lapply(wow,length)>0]
#split_5 <- matrix(wow2, ncol = length(wow2))
split_5 <- wow[lapply(wow,length)>0]
###
get_days <- function(i){
length(split_5[[i]])
}
num_days <- sapply(1:length(split_5), get_days)
###
get_hours_one_business <- function(i){
clean <- strsplit(as.character(split_5[[i]]), "-")
getpls <- function(k){
strsplit(as.character(clean[[k]]), ":")
}
cleaned <- sapply(1:num_days[i], getpls)
mat <- matrix(as.numeric(unlist(cleaned)), ncol = 4, byrow = TRUE)
mat2 <- cbind(abs(mat[,3] - mat[,1]), abs(mat[,4] - mat[,2])/60)
mat3 <- mat2[,1] + mat2[,2]
mat4 <- sum(mat3)
}
finally <- as.data.frame(sapply(seq_along(split_5), get_hours_one_business))
finally2 <- cbind(names(split_5), finally)
#names(finally) <- names(split_5)
colnames(finally2) <- c("business_id", "hours")
write.csv(finally2, file = "business_hours")
library(readr)
attrib <- read_csv("~/Downloads/business_attributes.csv")
View(attrib)
library(MASS)
View(attrib)
library(readr)
attrib <- read_csv("~/Downloads/business_attributes.csv")
yelp_business <- suppressWarnings(read_csv("~/Desktop/yelp_academic_dataset_business_train.csv"))
View(yelp_business)
library(readr)
attrib <- read_csv("~/Downloads/business_attributes.csv")
yelp_business <- suppressWarnings(read_csv("~/Desktop/yelp_academic_dataset_business_train.csv"))
attributes <- cbind(yelp_business$business_id,yelp_business$stars,attrib[,-1])
View(attributes)
library(MASS)
LDA_fit <- lda(yelp_business$stars~., data = attributes)
unique(attributes$restaurantsattire)
?glm
View(attributes)
library(MASS)
LDA_fit <- lda(yelp_business$stars~., data = attributes[,-1])
complete <- attributes[complete.cases(attributes),]
LDA_fit <- lda(yelp_business$stars~., data = attributes[,-1])
View(attributes)
complete <- attributes[complete.cases(attributes),]
View(complete)
complete <- attributes[complete.cases(attributes[,c(1:5)]),]
View(complete)
sum(is.na(attributes$col))
sum(is.na(attributes))
na_count <-sapply(attributes, function(y) sum(length(which(is.na(y)))))
na_count
attributes[,c(1:12, 15:21, 23:30,32:37, 39, 41)]
complete <- attributes[complete.cases(attributes[,c(1:12, 15:21, 23:30,32:37, 39, 41)]),]
View(complete)
View(complete)
LDA_fit <- lda(yelp_business$stars~., data = complete[,-1])
LDA_fit <- lda('yelp_business$stars'~., data = complete[,-1])
name(complete[,2]) <- "stars"
colname(complete[,2]) <- "stars"
?colname
??colnames
colnames(complete[,2]) <- "stars"
attrib <- read_csv("~/Downloads/business_attributes.csv")
yelp_business <- suppressWarnings(read_csv("~/Desktop/yelp_academic_dataset_business_train.csv"))
attributes <- cbind(business_id = yelp_business$business_id,stars = yelp_business$stars,attrib[,-1])
library(MASS)
na_count <-sapply(attributes, function(y) sum(length(which(is.na(y)))))
#get rid of byob, byobcorkage, caters, noiselevel, wheelchairaccessible,restaurantscounterservice,dogsallowed,byappointmentonly, all the rest of the hshit after that
complete <- attributes[complete.cases(attributes[,c(1:12, 15:21, 23:30,32:37, 39, 41)]),]
colnames(complete[,2]) <- "stars"
library(MASS)
na_count <-sapply(attributes, function(y) sum(length(which(is.na(y)))))
#get rid of byob, byobcorkage, caters, noiselevel, wheelchairaccessible,restaurantscounterservice,dogsallowed,byappointmentonly, all the rest of the hshit after that
complete <- attributes[complete.cases(attributes[,c(1:12, 15:21, 23:30,32:37, 39, 41)]),]
LDA_fit <- lda(stars~., data = complete[,-1])
unique(attribute[,1])
unique(complete[,1])
unique(complete[,2])
unique(complete[,3])
unique(complete[,4])
unique(complete[,5])
unique(complete[,6])
unique(complete[,7])
unique(complete[,8])
unique(complete[,9])
unique(complete[,10])
unique(complete[,11])
unique(complete[,12])
complete2 <- complete[,-c(1,4)]
LDA_fit <- lda(stars~., data = complete2)
unique(complete[,13])
complete <- attributes[complete.cases(attributes[,c(1:12, 15:21, 23:30,32:37, 39, 41)]),]
unique(complete[,13])
unique(complete[,14])
attributes2 <- attributes[,c(1:12, 15:21, 23:30,32:37, 39, 41)]
complete <- attributes2[complete.cases(attributes2),]
unique(complete[,13])
attributes2 <- attributes[,c(1:12, 15:21, 23:30,32:37, 39, 41)]
complete <- attributes2[complete.cases(attributes2),]
LDA_fit <- lda(stars~., data = complete)
View(complete2)
View(complete)
complete
LDA_fit <- lda(stars~., data = complete[,-1])
unique(complete[,4])
LDA_fit <- lda(stars~., data = complete[,-c(1,4)])
summary(LDA_fit)
plot(LDA_fit)
log_reg <- glm(stars~., data = complete[,-c(1,4)])
summary(log_reg)
final1 <- complete[,-c(1,4)]
final1 <- complete[,-c(1,4)]
final <- final1[,c(1,6,10,11,12,18:22,24,25,28)]
View(final)
final1 <- complete[,-4]
final <- final1[,c(1,6,10,11,12,18:22,24,25,28)]
View(final)
final1 <- complete[,-4]
final <- final1[,c(2,7,11:13,19:23,25,26,29)]
View(final)
View(final1)
log_reg <- glm(stars~., data = complete[,-c(1,4)])
summary(log_reg)
plot(log_reg)
final1 <- complete[,-4]
View(final1)
final <- final1[,c(2,3,7,11:13,19:23,25,26,29)]
View(final)
final1 <- complete[,-4]
final <- final1[,c(1,2,3,7,11:13,19:23,25,26,29)]
View(final)
write.csv(final, file = "business_attributes")
View(final)
library(MASS)
na_count <-sapply(attributes, function(y) sum(length(which(is.na(y)))))
#get rid of byob, byobcorkage, caters, noiselevel, wheelchairaccessible,restaurantscounterservice,dogsallowed,byappointmentonly, all the rest of the hshit after that
attributes2 <- attributes[,c(1:12, 15:21, 23:30,32:37, 39, 41)]
complete <- attributes2[complete.cases(attributes2),]
# variable 4 only has one value
#LDA_fit <- lda(stars~., data = complete[,-c(1,4)])
#summary(LDA_fit)
log_reg <- glm(stars~., data = complete[,-c(1,4)])
summary(log_reg)
plot(log_reg)
final1 <- complete[,-4]
final <- final1[,c(1,2,3,7,11:13,19:23,25,26,29)]
write.csv(final, file = "business_attributes")
library(MASS)
na_count <-sapply(attributes, function(y) sum(length(which(is.na(y)))))
#get rid of byob, byobcorkage, caters, noiselevel, wheelchairaccessible,restaurantscounterservice,dogsallowed,byappointmentonly, all the rest of the hshit after that
attributes2 <- attributes[,c(1:12, 15:21, 23:30,32:37, 39, 41)]
complete <- attributes2[complete.cases(attributes2),]
# variable 4 only has one value
#LDA_fit <- lda(stars~., data = complete[,-c(1,4)])
#summary(LDA_fit)
log_reg <- glm(stars~., data = complete[,-c(1,4)])
summary(log_reg)
plot(log_reg)
final1 <- complete[,-4]
final <- final1[,c(1,2,3,7,11:13,19:23,25,26,29)]
write.csv(final, file = "business_attributes_clean")
write.csv(final, file = "business_attributes_clean.csv")
View(attributes2)
attributes3 <- attributes2[,c(1,2,3,7,11:13,19:23,25,26,29)]
View(attributes3)
View(attributes2)
attributes3 <- attributes2[,c(1,2,3,8,12:14,20:24,26,27,30)]
View(attributes3)
View(final)
complete2 <- attributes3[complete.cases(attributes3),]
write.csv(complete2, file = "business_attributes_clean.csv")
write.csv(complete2, file = "business_attributes_clean2.csv")
library(readr)
hours <- read_csv("~/Downloads/business_hours")
library(readr)
hours <- read_csv("~/Downloads/business_hours.jpg")
library(readr)
hours <- read_csv("~/Downloads/business_hours.jpg")
attrib <- read_csv("~/Downloads/business_attributes_clean2.csv")
View(finally)
View(yelp_business)
View(yelp_business)
View(hours)
get_categories <- function(t){
x <- filter(yelp_business, business_id == t)
return(x$categories)
}
matrix <- sapply(hours$business_id, get_categories)
data <- cbind(hours,matrix)
View(data)
get_categories <- function(t){
x <- filter(yelp_business, business_id == t)
return(x$categories)
}
matrix <- sapply(hours$business_id, get_categories)
data <- cbind(hours,categories = matrix)
View(data)
data2 <- data[,c(3,4)]
View(data2)
attrib1 <- gsub("\\[|\\]", "", data2[,2])
attrib1
attrib1 <- gsub("\\[|\\]", "", data2[,2])
attrib2 <- strsplit(attrib1, ",")
get_time <- function(t){
split_1 <- gsub(".*day\\s(.*?)*", "", x = split[[t]] )
split_2 <- strsplit(split_1, "'")
}
attrib2
attrib3 <- gsub("\\'(.*?)\\'", attrib2)
attrib3 <- gsub("\\'(.*?)\\'", "",attrib2)
attrib3
attrib3 <- gsub("^\\'(.*?)\\'", "",attrib2)
attrib3
attrib3 <- gsub("^\\'", "",attrib2)
attrib3
attrib3 <- strsplit(attrib2, "'")
attrib3 <- strsplit(attrib2, "\\'")
attrib2
attrib3 <- gsub("'", '', attrib2)
attrib3
attrib1
attrib3 <- gsub("'", '', attrib1)
attrib3
attrib3 <- gsub("'", '', data2[,2])
attrib3
attrib3 <- gsub("'", '', attrib1)
attrib3
attrib3 <- gsub("\\,\\s", "", attrib2)
attrib3
attrib3 <- gsub(",\\s", "", attrib2)
attrib3
attrib3 <- gsub(", ", "", attrib2)
attrib3
attrib3 <- strsplit(attrib2, ",")
attrib3 <- strsplit(attrib2, "\\,")
attrib2
attrib1 <- gsub("\\[|\\]", "", data2[,2])
attrib2 <- gsub("'", '', attrib1)
attrib2
attrib3 <- strsplit(attrib2, ",")
attrib3
trim.leading <- function (x)  sub("^\\s+", "", x)
attrib4 <- trim.leading(attrib3)
attrib4
attrib3
?matrix
attrib4 <- matrix(unlist(attrib3), ncol = 2, byrow = TRUE)
attrib4
attrib5 <- trim.leading(attrib4[,2])
attrib5
final <- cbind(attrib4[,1], attrib5)
View(final)
final <- cbind(attrib4[,1], V2 = attrib5)
View(final)
data2
View(final)
final2 <- sub("Restaurant", "", final)
final2
final <- cbind(attrib4[,1], V2 = attrib5)
final$categories <- paste(final$V1,final$V2)
final$categories <- paste(final[,1],final[,2])
final
aste(final[,1],final[,2])
paste(final[,1],final[,2])
final <- cbind(attrib4[,1], V2 = attrib5)
final2 <- paste(final[,1],final[,2])
final2
final3 <- sub("^\\s+Restaurants", "", final2)
final3
final3 <- sub("\\s+Restaurants", "", final2)
final3
final4 <- sub("Restaurants\\s+", "", final3)
final4
final <- cbind(attrib4[,1], V2 = attrib5)
final2 <- paste(final[,1],final[,2])
final3 <- sub("\\s+Restaurants", "", final2)
final4 <- sub("Restaurants\\s+", "", final3)
final5 <- sub("\\s+Food", "", final4)
final6 <- sub("Food\\s+", "", final5)
final6
wew <- cbind(data2[,1], final6)
wew
wew <- cbind(as.numeric(data2[,1]), final6)
wew
wew <- matrix(cbind(unlist(data2[,1]), final6))
wew
wew <- matrix(cbind(c(unlist(data2[,1])), final6))
wew
wew <- as.matrix(cbind(data2[,1], final6))
wew
new <- as.numeric(wew[,1])
new
finally <- cbind(new, wew[,2])
finally
wew <- as.matrix(cbind(data2[,1], final6))
new <- as.numeric(wew[,1])
finally <- cbind.data.frame(new, wew[,2])
finally
finally <- cbind.data.frame(new, categories = wew[,2])
?randomForest
??randomForest
finally
finally <- cbind.data.frame(hours = new, categories = wew[,2])
finally
library(randomForest)
?randomForest
unique(finally$categories)
fit <- randomForest(hours~categories, data = finally, mtry = 2, importance = TRUE)
fit <- randomForest(hours~categories, data = finally, mtry = 1, importance = TRUE)
dummies = model.matrix(~finally[,2])
dummies
View(dummies)
unique(finally$categories)
View(dummies)
contrasts(finally[,2])
finally2 <- cbind.data.frame(hours = finally[,1], dummies[,-1])
finally2
fit <- randomForest(hours~., data = finally2, mtry = 2, importance = TRUE)
finally2
?as.factor
finally2 <- cbind.data.frame(hours = finally[,1], as.factor(dummies[,-1]))
fit <- randomForest(hours~., data = finally2, mtry = 2, importance = TRUE)
finally2
dummies = model.matrix(~finally[,2])
dummies
dummies <- as.matrix(model.matrix(~finally[,2]))
dummies
finally2 <- cbind.data.frame(hours = finally[,1], as.factor(dummies[,-1]))
finally2
dummies[,-1]
finally2 <- cbind.data.frame(hours = finally[,1], dummies[,-1])
finally2
finally2 <- cbind.(hours = finally[,1], dummies[,-1])
finally2 <- cbind(hours = finally[,1], dummies[,-1])
finally2
fit <- randomForest(hours~., data = finally2, mtry = 2, importance = TRUE)
finally2
fit <- randomForest(hours~., data = finally2, mtry = 2, importance = TRUE)
finally2
colnames(finally2) <- c("hours", "coffee_tea", "mexican")
finally2 <- cbind(hours = finally[,1], dummies[,-1])
View(finally2)
colnames(finally2) <- c("hours", "coffee_tea", "mexican", "pizza")
View(finally2)
fit <- randomForest(hours~., data = finally2, mtry = 2, importance = TRUE)
missing <- yelp_business[is.na(yelp_business$hours),]
missing
View(missing)
missing2 <- missing[,c(3,4,8)]
missing <- yelp_business[is.na(yelp_business$hours),]
missing2 <- missing[,c(3,4,8)]
#now turn those categories righteo
attrib1 <- gsub("\\[|\\]", "", missing2[,8])
missing <- yelp_business[is.na(yelp_business$hours),]
missing2 <- missing[,c(3,4,8)]
#now turn those categories righteo
attrib1 <- gsub("\\[|\\]", "", missing2[,3])
attrib2 <- gsub("'", '', attrib1)
attrib3 <- strsplit(attrib2, ",")
attrib4 <- matrix(unlist(attrib3), ncol = 2, byrow = TRUE)
trim.leading <- function (x)  sub("^\\s+", "", x)
attrib5 <- trim.leading(attrib4[,2])
final <- cbind(attrib4[,1], V2 = attrib5)
final2 <- paste(final[,1],final[,2])
final3 <- sub("\\s+Restaurants", "", final2)
final4 <- sub("Restaurants\\s+", "", final3)
final5 <- sub("\\s+Food", "", final4)
final6 <- sub("Food\\s+", "", final5)
final6
final5
final4
final3
final2
final
attrib4
attrib1
missing2
missing2[,3]
attrib1 <- gsub("\\[|\\]", "", missing2[,3])
attrib1
data2[,2]
missing2[,3]
sub("\\[|\\]", "", missing2[,3])
typeof(missing2[,3])
attrib1
attrib1 <- gsub("^\\[", "", missing2[,3])
attrib1
typeof(data2[,2])
dur <- as.data.frame(missing2[,3])
attrib1 <- gsub("\\[|\\]", "", dur)
attrib1
dur <- as.integer(missing2[,3])
dur <- unlist(missing2[,3])
attrib1 <- gsub("\\[|\\]", "", dur)
attrib1
missing2 <- missing[,c(3,4,8)]
dur <- unlist(missing2[,3])
attrib1 <- gsub("\\[|\\]", "", dur)
attrib1
missing2 <- missing[,c(3,4,8)]
dur <- c(unlist(missing2[,3]))
attrib1 <- gsub("\\[|\\]", "", dur)
attrib1
dur <- as.matrix(unlist(missing2[,3]))
attrib1 <- gsub("\\[|\\]", "", dur)
attrib1
attrib2 <- gsub("'", '', attrib1)
attrib2
attrib3 <- strsplit(attrib2, ",")
attrib4 <- matrix(unlist(attrib3), ncol = 2, byrow = TRUE)
trim.leading <- function (x)  sub("^\\s+", "", x)
attrib5 <- trim.leading(attrib4[,2])
final <- cbind(attrib4[,1], V2 = attrib5)
final2 <- paste(final[,1],final[,2])
final3 <- sub("\\s+Restaurants", "", final2)
final4 <- sub("Restaurants\\s+", "", final3)
final5 <- sub("\\s+Food", "", final4)
final6 <- sub("Food\\s+", "", final5)
final6
okay <- cbind(missing2[,c(1,2)], final6)
okay
?predict
okay1 <- predict(okay$final6, fit)
